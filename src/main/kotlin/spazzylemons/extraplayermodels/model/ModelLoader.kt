package spazzylemons.extraplayermodels.model

import com.google.gson.Gson
import com.google.gson.GsonBuilder
import net.minecraft.client.MinecraftClient
import net.minecraft.client.util.math.Vector3f
import spazzylemons.extraplayermodels.client.Configuration
import spazzylemons.extraplayermodels.model.json.*
import java.io.File

object ModelLoader {
    /**
     * The default configuration.
     */
    private const val DEFAULT_MODEL =
"""{
  "__comment": [
    "An explanation of this model file:",

    "Each of the six limbs here is a model part. A model part is part of an entity model.",
    "Rotation is in degrees, and coordinates are 16 times that of Minecraft coordinates.",
    
    "A model part has these properties:",
    "pivot ------- The point on the part where it is rotated.",
    "rotation ---- The rotation of the part.",
    "boxes ------- The boxes for the part.",
    "children ---- Parts which inherit some properties of this part.",
    
    "A box has these properties:",
    "start ------- Where the lower corner of the box is.",
    "size -------- The size of the box.",
    "extra ------- The amount to stretch the box.",
    "uv ---------- Where the texture is."
  ],
  "head": {
    "pivot": [0, 0, 0],
    "rotation": [0, 0, 0],
    "boxes": [
      {
        "start": [-4, -8, -4],
        "size": [8, 8, 8],
        "extra": [0, 0, 0],
        "uv": [0, 0]
      },
      {
        "start": [-4, -8, -4],
        "size": [8, 8, 8],
        "extra": [0.5, 0.5, 0.5],
        "uv": [32, 0]
      }
    ],
    "children": []
  },
  "torso": {
    "pivot": [0, 0, 0],
    "rotation": [0, 0, 0],
    "boxes": [
      {
        "start": [-4, 0, -2],
        "size": [8, 12, 4],
        "extra": [0, 0, 0],
        "uv": [16, 16]
      },
      {
        "start": [-4, 0, -2],
        "size": [8, 12, 4],
        "extra": [0.25, 0.25, 0.25],
        "uv": [16, 32]
      }
    ],
    "children": []
  },
  "leftArm": {
    "pivot": [0, 0, 0],
    "rotation": [0, 0, 0],
    "boxes": [
      {
        "start": [-1, -2, -2],
        "size": [4, 12, 4],
        "extra": [0, 0, 0],
        "uv": [32, 48]
      },
      {
        "start": [-1, -2, -2],
        "size": [4, 12, 4],
        "extra": [0.25, 0.25, 0.25],
        "uv": [48, 48]
      }
    ],
    "children": []
  },
  "rightArm": {
    "pivot": [0, 0, 0],
    "rotation": [0, 0, 0],
    "boxes": [
      {
        "start": [-3, -2, -2],
        "size": [4, 12, 4],
        "extra": [0, 0, 0],
        "uv": [40, 16]
      },
      {
        "start": [-3, -2, -2],
        "size": [4, 12, 4],
        "extra": [0.25, 0.25, 0.25],
        "uv": [40, 32]
      }
    ],
    "children": []
  },
  "leftLeg": {
    "pivot": [0, 0, 0],
    "rotation": [0, 0, 0],
    "boxes": [
      {
        "start": [-4, 0, -2],
        "size": [4, 12, 4],
        "extra": [0, 0, 0],
        "uv": [0, 16]
      },
      {
        "start": [-4, 0, -2],
        "size": [4, 12, 4],
        "extra": [0.25, 0.25, 0.25],
        "uv": [0, 32]
      }
    ],
    "children": []
  },
  "rightLeg": {
    "pivot": [0, 0, 0],
    "rotation": [0, 0, 0],
    "boxes": [
      {
        "start": [0, 0, -2],
        "size": [4, 12, 4],
        "extra": [0, 0, 0],
        "uv": [16, 48]
      },
      {
        "start": [0, 0, -2],
        "size": [4, 12, 4],
        "extra": [0.25, 0.25, 0.25],
        "uv": [0, 48]
      }
    ],
    "children": []
  },
  "texture": "default.png"
}"""

    /**
     * The default skin, as the bytes of the PNG. Thinking about ways to make this neater.
     */
    private val DEFAULT_TEXTURE = byteArrayOf(
        0x89.toByte(),0x50,0x4e,0x47,0x0d,0x0a,0x1a,0x0a,0x00,0x00,0x00,0x0d,0x49,0x48,0x44,0x52,
        0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x40,0x08,0x06,0x00,0x00,0x00,0xaa.toByte(),0x69,0x71,
        0xde.toByte(),0x00,0x00,0x05,0x0d,0x49,0x44,0x41,0x54,0x78,0xda.toByte(),0xed.toByte(),0x9a.toByte(),0xdb.toByte(),0x4b,0x14,
        0x51,0x1c,0xc7.toByte(),0xf7.toByte(),0xb1.toByte(),0xb4.toByte(),0x2c,0xa3.toByte(),0x28,0xb4.toByte(),0xfb.toByte(),0x96.toByte(),0x6d,0x5a,0x6c,0x96.toByte(),
        0x3d,0x68,0x94.toByte(),0x95.toByte(),0xdd.toByte(),0x8c.toByte(),0x28,0x32,0x8a.toByte(),0xca.toByte(),0x30,0xb1.toByte(),0x28,0xf3.toByte(),0x82.toByte(),0xb0.toByte(),
        0x74,0x81.toByte(),0x22,0xb2.toByte(),0x0b,0x95.toByte(),0x05,0xd5.toByte(),0x93.toByte(),0x50,0x58,0x41,0x10,0x48,0x14,0x3d,
        0x74,0x7b,0x08,0x7b,0xec.toByte(),0xc9.toByte(),0xff.toByte(),0xe9.toByte(),0xd7.toByte(),0x7c,0xcf.toByte(),0xec.toByte(),0x6f,0xfa.toByte(),0xcd.toByte(),0xe1.toByte(),
        0x9c.toByte(),0x19,0xf7.toByte(),0xa2.toByte(),0xce.toByte(),0xae.toByte(),0x73,0xe0.toByte(),0xcb.toByte(),0x1c,0xcf.toByte(),0xfc.toByte(),0xce.toByte(),0xd9.toByte(),0xf9.toByte(),0x7e,
        0xce.toByte(),0x65,0xcf.toByte(),0x7a,0x26,0x91.toByte(),0x08,0x49,0xf5.toByte(),0xab.toByte(),0x16,0x12,0xb4.toByte(),0x61,0xc5.toByte(),0x3c,
        0x92.toByte(),0x79,0x68,0xcd.toByte(),0xe2.toByte(),0x4a,0xba.toByte(),0x71,0x38,0x1d,0xa8.toByte(),0x44,0xa9.toByte(),0x27,0x36,0x9c.toByte(),
        0x5e,0xb3.toByte(),0x48,0x49,0x02,0x80.toByte(),0x60,0xb2.toByte(),0x6f,0xef.toByte(),0x36,0x7a,0x7c,0xaa.toByte(),0xc9.toByte(),0xbb.toByte(),
        0x42,0x65,0x05,0x80.toByte(),0xcd.toByte(),0xd7.toByte(),0xd5.toByte(),0x54,0x58,0x01,0x24,0x93.toByte(),0x49,0x9f.toByte(),0x50,0x56,
        0x16,0x00,0xb8.toByte(),0xf7.toByte(),0xf5.toByte(),0x69,0xc0.toByte(),0x65,0x65,0x0f,0x40,0x9a.toByte(),0xc5.toByte(),0x08,0x80.toByte(),0xe4.toByte(),
        0x74,0x98.toByte(),0x13,0x00,0x4c,0xe6.toByte(),0xc3.toByte(),0x00,0x74,0xa4.toByte(),0xea.toByte(),0xca.toByte(),0x07,0x00,0x1b,0xdf.toByte(),
        0xbc.toByte(),0x72,0x81.toByte(),0xca.toByte(),0x63,0xf5.toByte(),0xd7.toByte(),0x01,0x98.toByte(),0x54,0x36,0x00,0xd8.toByte(),0xb8.toByte(),0x14,0x8f.toByte(),
        0x8c.toByte(),0x92.toByte(),0xff.toByte(),0x1a,0x4c,0xd5.toByte(),0x56,0x10,0x04,0x53,0x9b.toByte(),0x6a,0x2b,0x95.toByte(),0xd9.toByte(),0xed.toByte(),
        0xc9.toByte(),0xc5.toByte(),0xb4.toByte(),0x75,0xad.toByte(),0xab.toByte(),0xf4.toByte(),0xda.toByte(),0x85.toByte(),0xd4.toByte(),0xb0.toByte(),0xda.toByte(),0x5d,0x07,0x52,0x2b,
        0x2b,0xd5.toByte(),0x42,0x88.toByte(),0x58,0x94.toByte(),0x01,0x00,0xc7.toByte(),0xa1.toByte(),0x0e,0xea.toByte(),0xa2.toByte(),0x0d,0xdc.toByte(),0xe7.toByte(),
        0x76,0xc3.toByte(),0xf6.toByte(),0x11,0x91.toByte(),0x02,0x00,0x6d,0x59,0x5d,0xa5.toByte(),0x8c.toByte(),0xc0.toByte(),0xe0.toByte(),0x8e.toByte(),0x0d,
        0xd5.toByte(),0xea.toByte(),0xca.toByte(),0xc2.toByte(),0xdf.toByte(),0xfb.toByte(),0xeb.toByte(),0x97.toByte(),0x50,0x6b,0xfd.toByte(),0x32,0x15,0x07,0x20,0x1c,
        0x83.toByte(),0x3a,0x28,0xe3.toByte(),0x76,0x24,0x80.toByte(),0xa0.toByte(),0x7d,0xc4.toByte(),0xac.toByte(),0x03,0x50,0x0f,0xbd.toByte(),0xc2.toByte(),
        0xed.toByte(),0x35,0xd7.toByte(),0xb8.toByte(),0x63,0xac.toByte(),0x16,0x3d,0x5d,0xe1.toByte(),0x81.toByte(),0xf8.toByte(),0x39,0x32,0x40,0x13,
        0x2f,0x32,0xf4.toByte(),0x77,0x74,0x98.toByte(),0x26,0x9e.toByte(),0x67,0x9c.toByte(),0xfc.toByte(),0x75,0xfa.toByte(),0x7c,0xf3.toByte(),0x3c,
        0x35,0x6d,0x5c,0xa2.toByte(),0x62,0x10,0x8b.toByte(),0x3a,0x0d,0x59,0x78,0x0a,0x82.toByte(),0xd3.toByte(),0x26,0xda.toByte(),
        0x0e,0xdb.toByte(),0x47,0x44,0x63,0x04,0xd4.toByte(),0x38,0x43,0x79,0x55,0x95.toByte(),0xdb.toByte(),0xab.toByte(),0xb5.toByte(),0xee.toByte(),
        0x54,0x40,0x3e,0xbd.toByte(),0xbe.toByte(),0x9a.toByte(),0x3e,0xdd.toByte(),0xbd.toByte(),0x42,0xdf.toByte(),0x1f,0x0d,0xaa.toByte(),0xeb.toByte(),0x97.toByte(),
        0xe1.toByte(),0x41,0x1a,0xcb.toByte(),0x5c,0xa0.toByte(),0xdf.toByte(),0x23,0x19,0x1a,0xbb.toByte(),0x76,0x4c,0x09,0x31,0x88.toByte(),
        0x45,0x1d,0xd4.toByte(),0x45,0x1e,0x6d,0xa1.toByte(),0x4d,0xfc.toByte(),0x1d,0xb6.toByte(),0x8f.toByte(),0x88.toByte(),0xcc.toByte(),0x14,0x70,
        0xa7.toByte(),0xc1.toByte(),0x02,0x4a,0x2e,0x9f.toByte(),0x4f,0x4f,0xce.toByte(),0xb6.toByte(),0xd0.toByte(),0xd8.toByte(),0xa5.toByte(),0x83.toByte(),0xd4.toByte(),0x92.toByte(),
        0x5a,0xaa.toByte(),0xcc.toByte(),0x23,0x75,0xec.toByte(),0x1e,0xa1.toByte(),0x1f,0x77,0xae.toByte(),0x2a,0xf3.toByte(),0xc8.toByte(),0x23,0x01,
        0x0a,0x62,0x10,0x8b.toByte(),0x3a,0xa8.toByte(),0x8b.toByte(),0x36,0x64,0x9b.toByte(),0x61,0xfb.toByte(),0x88.toByte(),0xe8.toByte(),0x00,0x70,
        0x7a,0xcc.toByte(),0x1d,0xb6.toByte(),0xd5.toByte(),0xf4.toByte(),0xa8.toByte(),0xa3.toByte(),0x91.toByte(),0x46,0x2f,0xee.toByte(),0xa3.toByte(),0xa7.toByte(),0xe7.toByte(),0x9b.toByte(),
        0x1d,0x73,0x87.toByte(),0xe8.toByte(),0xdb.toByte(),0x9d.toByte(),0x1e,0xfa.toByte(),0xf5.toByte(),0x20,0xe3.toByte(),0x7d,0xbd.toByte(),0xfd.toByte(),0x79,0x3a,
        0x40,0x1f,0xfa.toByte(),0x0e,0xd3.toByte(),0xb0.toByte(),0xb3.toByte(),0xe7.toByte(),0x47,0x0c,0x62,0x51,0x07,0x75,0xd1.toByte(),0x06,
        0xf7.toByte(),0xbe.toByte(),0x5c,0x04,0x6d,0xfb.toByte(),0x88.toByte(),0x48,0xac.toByte(),0x01,0x78,0x50,0x0c,0xdb.toByte(),0x9e.toByte(),0xb6.toByte(),
        0x34,0xbd.toByte(),0xed.toByte(),0x3b,0x41,0x6f,0x2e,0x1d,0xf0.toByte(),0x7e,0xd0.toByte(),0xbc.toByte(),0xea.toByte(),0x6a,0x73,0x0c,
        0xee.toByte(),0xa5.toByte(),0x5b,0xfb.toByte(),0x77,0xfa.toByte(),0xf4.toByte(),0xb2.toByte(),0x6b,0x0f,0xdd.toByte(),0x3f,0xd5.toByte(),0xac.toByte(),0x62,0x10,
        0x8b.toByte(),0x3a,0xa8.toByte(),0x8b.toByte(),0x36,0xd4.toByte(),0x14,0xc8.toByte(),0x4e,0x87.toByte(),0xb0.toByte(),0x7d,0xc4.toByte(),0xac.toByte(),0x03,0xe0.toByte(),
        0x5f,0x6f,0x6c,0x7a,0xec.toByte(),0xea.toByte(),0x11,0xd5.toByte(),0xa3.toByte(),0xcf.toByte(),0xce.toByte(),0xed.toByte(),0xa2.toByte(),0xeb.toByte(),0x47,0xd2.toByte(),
        0x34,0x74,0x70,0x0b,0x0d,0xb6.toByte(),0xd5.toByte(),0x2b,0xb3.toByte(),0xd0.toByte(),0xed.toByte(),0xe3.toByte(),0x3b,0xe8.toByte(),0xe1.toByte(),0xe9.toByte(),
        0x5d,0x4a,0xc8.toByte(),0x23,0x06,0xb1.toByte(),0xef.toByte(),0x7b,0xdb.toByte(),0x55,0xdd.toByte(),0x37,0x97.toByte(),0x8f.toByte(),0xba.toByte(),0xd7.toByte(),
        0x6c,0x7b,0x0c,0x52,0xdf.toByte(),0x47,0x30,0xb8.toByte(),0xc8.toByte(),0xed.toByte(),0x0b,0xce.toByte(),0xb4.toByte(),0x4f,0x92.toByte(),0x54,
        0x2a,0x95.toByte(),0xf2.toByte(),0x29,0xb4.toByte(),0x81.toByte(),0xc9.toByte(),0x49,0xfb.toByte(),0xa6.toByte(),0xc8.toByte(),0xb9.toByte(),0x97.toByte(),0xe8.toByte(),0xee.toByte(),0x0e,
        0x56,0x58,0x1a,0x1f,0x77,0xdb.toByte(),0x81.toByte(),0x9c.toByte(),0x3c,0xa6.toByte(),0xe4.toByte(),0xc9.toByte(),0xc6.toByte(),0x8d.toByte(),0xde.toByte(),0x35,
        0x12,0x00,0x6c,0x5b,0xe3.toByte(),0xa2.toByte(),0x00,0x60,0xf3.toByte(),0x59,0xcd.toByte(),0x6d,0x00,0xce.toByte(),0x08,0x90.toByte(),
        0xe6.toByte(),0xd5.toByte(),0x67,0xcc.toByte(),0xb5.toByte(),0x29,0x50,0x30,0x80.toByte(),0x6d,0xa9.toByte(),0x0c,0x41,0x75,0xeb.toByte(),0x3a,
        0xd5.toByte(),0xf5.toByte(),0x50,0xcb.toByte(),0x47,0x9f.toByte(),0xe4.toByte(),0x3d,0xfd.toByte(),0x7e,0x4b,0xe3.toByte(),0x08,0x25,0xee.toByte(),0xdd.toByte(),
        0xfb.toByte(),0xaf.toByte(),0xce.toByte(),0x4e,0x4a,0xbc.toByte(),0x7e,0x4d,0x89.toByte(),0x77,0xef.toByte(),0xd4.toByte(),0x82.toByte(),0x89.toByte(),0xaf.toByte(),0x4a,
        0x5e,0x3c,0x51,0xa6.toByte(),0x24,0xe3.toByte(),0x21,0x94.toByte(),0xc1.toByte(),0x14,0xeb.toByte(),0xeb.toByte(),0x57,0x57,0xfc.toByte(),0xb7.toByte(),
        0x2d,0x9e.toByte(),0x63,0xf4.toByte(),0xfb.toByte(),0x5c,0x9f.toByte(),0x35,0x15,0x00,0x30,0x98.toByte(),0x0f,0x00,0x48,0x7d,
        0x68,0x6f,0xaf.toByte(),0x2b,0xe4.toByte(),0xf9.toByte(),0xc1.toByte(),0xb3.toByte(),0x10,0x3c,0xf3.toByte(),0xfc.toByte(),0x40,0x32,0x1e,0x92.toByte(),
        0xa6.toByte(),0xa5.toByte(),0xb8.toByte(),0x1d,0x19,0xcb.toByte(),0x06,0xb9.toByte(),0x0e,0x03,0xd5.toByte(),0xef.toByte(),0xe7.toByte(),0x03,0xc0.toByte(),0x66,
        0x30,0x14,0x80.toByte(),0xe9.toByte(),0x01,0xf9.toByte(),0x21,0xf1.toByte(),0x80.toByte(),0x18,0x11,0xd2.toByte(),0xa4.toByte(),0x8c.toByte(),0x87.toByte(),0x4c,
        0xe6.toByte(),0x65,0x1b,0x26,0xc0.toByte(),0x32,0x66,0xd6.toByte(),0x01,0x60,0xd8.toByte(),0xf3.toByte(),0x03,0x20,0x2f,0x3f,
        0x9c.toByte(),0x01,0xc8.toByte(),0x32,0x5b,0x3c,0xc7.toByte(),0xc1.toByte(),0xa0.toByte(),0xcc.toByte(),0xeb.toByte(),0x06,0xe5.toByte(),0x68,0x9a.toByte(),0xa9.toByte(),
        0x11,0x20,0x63,0x30,0xef.toByte(),0xa5.toByte(),0x3c,0x23,0x2c,0x3c,0xbc.toByte(),0x34,0xcd.toByte(),0x79,0x2e,0x97.toByte(),
        0xb1.toByte(),0x0c,0x40,0x37,0x2d,0xea.toByte(),0x63,0x53,0xc6.toByte(),0x7a,0xe2.toByte(),0x6c,0xbe.toByte(),0xf0.toByte(),0xfb.toByte(),0x43,
        0x0a,0x65,0x32,0x46,0xbf.toByte(),0x9f.toByte(),0x17,0x00,0x36,0x27,0x47,0x80.toByte(),0x15,0x80.toByte(),0x34,0x03,
        0x18,0x12,0x80.toByte(),0xc9.toByte(),0x98.toByte(),0x04,0xc6.toByte(),0x53,0xc0.toByte(),0x54,0x27,0x3b,0xd4.toByte(),0x4d,0x00,0x46,
        0x87.toByte(),0x3a,0x3d,0x83.toByte(),0x5c,0x5e,0x54,0x00,0x39,0xaf.toByte(),0x01,0x3a,0x00,0xd9.toByte(),0xfb.toByte(),0x72,
        0xc5.toByte(),0x96.toByte(),0x00,0xe4.toByte(),0x1a,0xa0.toByte(),0x99.toByte(),0x96.toByte(),0x40,0xa4.toByte(),0x39,0x1d,0x00,0xae.toByte(),0x26,0x00,
        0xaa.toByte(),0x3c,0x1b,0x33,0xe5.toByte(),0xaf.toByte(),0xc1.toByte(),0xbc.toByte(),0x01,0xe8.toByte(),0x73,0x30,0x0c,0x80.toByte(),0xfe.toByte(),0x2d,
        0x60,0x8a.toByte(),0xb5.toByte(),0x00,0xd0.toByte(),0x7b,0x58,0x07,0x60,0x9a.toByte(),0x22,0x45,0x01,0x10,0x74,0x3f,
        0x70,0x11,0xd2.toByte(),0xbf.toByte(),0x01,0x74,0x00,0xa6.toByte(),0x45,0x4b,0x93.toByte(),0x34,0x67,0x03,0x10,0xb4.toByte(),
        0x46,0x84.toByte(),0x02,0x68,0x6d,0x6d,0x25,0x28,0x0c,0x00,0xc7.toByte(),0xf5.toByte(),0xf7.toByte(),0xf7.toByte(),0xfb.toByte(),0xe4.toByte(),
        0x19,0xe2.toByte(),0x8d.toByte(),0x08,0xf7.toByte(),0x9e.toByte(),0xde.toByte(),0xfb.toByte(),0x36,0x00,0x32,0xde.toByte(),0xb0.toByte(),0x1e,0x48,0x73,
        0xa6.toByte(),0x39,0x2e,0x01,0xc8.toByte(),0x29,0xc0.toByte(),0xd7.toByte(),0x29,0x03,0xb0.toByte(),0x19,0x0c,0xbb.toByte(),0x2f,0xa7.toByte(),
        0x08,0xae.toByte(),0x3a,0x40,0x6f,0xc7.toByte(),0x28,0x00,0xe8.toByte(),0x1b,0x2f,0x6f,0x41,0xe5.toByte(),0x69,0xe2.toByte(),
        0x88.toByte(),0x17,0x61,0x1b,0x00,0x36,0x69,0x1a,0x21,0xb3.toByte(),0x06,0xc0.toByte(),0x34,0x82.toByte(),0x7c,0x10,
        0x1c,0x63,0xa1.toByte(),0x5b,0x6b,0x27,0x46,0x96.toByte(),0xe9.toByte(),0x3d,0xec.toByte(),0x5b,0x00,0x1d,0x99.toByte(),0xd6.toByte(),
        0x88.toByte(),0x9c.toByte(),0x00,0xc4.toByte(),0x29,0x4e,0x71,0x8a.toByte(),0x53,0x9c.toByte(),0xe2.toByte(),0x14,0xa7.toByte(),0x38,0xc5.toByte(),0x29,
        0x4e,0x71,0x8a.toByte(),0x53,0x9c.toByte(),0xe2.toByte(),0x14,0xa7.toByte(),0x38,0x15,0x9a.toByte(),0x0a,0x3e,0x5c,0x2d,0xf6.toByte(),
        0xe1.toByte(),0x67,0xc9.toByte(),0x01,0xd0.toByte(),0xce.toByte(),0xff.toByte(),0xe7.toByte(),0x1e,0x00,0x39,0x02,0xa6.toByte(),0xe3.toByte(),0x05,0x88.toByte(),
        0x52,0x9b.toByte(),0x02,0x91.toByte(),0x07,0x90.toByte(),0xeb.toByte(),0xfb.toByte(),0x05,0xfc.toByte(),0xdf.toByte(),0x5e,0xdf.toByte(),0xb9.toByte(),0x82.toByte(),0x94.toByte(),
        0xfc.toByte(),0x57,0xba.toByte(),0xe9.toByte(),0x7d,0x82.toByte(),0x5c,0x0f,0x3f,0xa3.toByte(),0x02,0xc0.toByte(),0x76,0xdf.toByte(),0x7a,0xfa.toByte(),
        0xcb.toByte(),0x20,0x6c,0x27,0x49,0xa5.toByte(),0x04,0x20,0xe8.toByte(),0x7e,0xe0.toByte(),0x49,0x91.toByte(),0xe9.toByte(),0x78,0xbc.toByte(),
        0xec.toByte(),0x01,0x14,0xfb.toByte(),0xfc.toByte(),0x7f,0x26,0x00,0x14,0xf2.toByte(),0x7e,0xc1.toByte(),0xb4.toByte(),0x9f.toByte(),0xff.toByte(),0xcf.toByte(),
        0x14,0x00,0xd3.toByte(),0x51,0x57,0x2e,0x00,0xc2.toByte(),0x8e.toByte(),0xbe.toByte(),0x22,0x0d,0xa0.toByte(),0x90.toByte(),0x29,0xa0.toByte(),
        0x03,0x90.toByte(),0xc7.toByte(),0x5a,0x3a,0x00,0xf9.toByte(),0x7e,0xc0.toByte(),0x94.toByte(),0xcf.toByte(),0xff.toByte(),0xa3.toByte(),0x02,0xc0.toByte(),0x36,
        0x45,0xf4.toByte(),0xc3.toByte(),0x4d,0xf9.toByte(),0xf6.toByte(),0x87.toByte(),0x7e,0xfa.toByte(),0x9b.toByte(),0xd7.toByte(),0xf1.toByte(),0xf7.toByte(),0x4c,0x01,0xc8.toByte(),
        0xf7.toByte(),0xfd.toByte(),0x02,0x7d,0x88.toByte(),0x9b.toByte(),0x00,0x14,0xf4.toByte(),0x02,0xc4.toByte(),0x74,0xa7.toByte(),0x42,0xdf.toByte(),0x2f,
        0x30,0x9d.toByte(),0xef.toByte(),0xdb.toByte(),0x00,0x98.toByte(),0xa6.toByte(),0x48,0x64,0x00,0xe4.toByte(),0x7b,0xbc.toByte(),0x6e,0xea.toByte(),0xe1.toByte(),
        0xa0.toByte(),0x97.toByte(),0xa0.toByte(),0xca.toByte(),0x12,0x80.toByte(),0x6f,0x21,0x14,0x0b,0x9c.toByte(),0xfe.toByte(),0x0a,0xcc.toByte(),0x74,0x00,
        0xf8.toByte(),0x07,0xf9.toByte(),0x07,0x97.toByte(),0xd7.toByte(),0x5a,0xec.toByte(),0xd7.toByte(),0xbd.toByte(),0x00,0x00,0x00,0x00,0x49,0x45,
        0x4e,0x44,0xae.toByte(),0x42,0x60,0x82.toByte()
    )

    /**
     * The default config.
     */
    private const val DEFAULT_CONFIG =
"""{
  "__comment": [
    "Model property is the model in models folder, or null if disabled"
  ],
  "model": "default.json"
}"""

    /**
     * The [Gson] used to parse the configuration file.
     */
    val gson: Gson = GsonBuilder()
        .registerTypeAdapter(Vector3f::class.java,
            VectorDeserializer()
        )
        .registerTypeAdapter(UVCoordinate::class.java,
            UVDeserializer()
        )
        .registerTypeAdapter(ImageArray::class.java,
            ImageArrayDeserializer()
        )
        .registerTypeAdapter(CustomPlayerModel::class.java,
            CustomPlayerModelDeserializer()
        )
        .registerTypeAdapter(CustomModelPart::class.java,
            CustomModelPartDeserializer()
        )
        .registerTypeAdapter(CustomModelBox::class.java,
            CustomModelBoxDeserializer()
        )
        .registerTypeAdapter(Configuration::class.java,
            ConfigurationDeserializer()
        )
        .create()

    /**
     * Load the player model from the configuration file, or create one if none exists.
     *
     * @return The [CustomPlayerModel] generated.
     */
    fun load(): Configuration {
        // Get our folder first.
        val ourFolder = File(MinecraftClient.getInstance().runDirectory, "config/extraplayermodels")
        // Make if it doesn't exist.
        ourFolder.mkdirs()
        // Also make sure that the models and textures folders exist.
        File(ourFolder, "models").mkdirs()
        File(ourFolder, "textures").mkdirs()
        // Get the config file.
        val configFile = File(ourFolder, "config.json")
        if (!configFile.exists()) {
            // If there's no config file, make it, and add defaults if not present.
            configFile.writeText(DEFAULT_CONFIG, Charsets.UTF_8)
            val defaultModel = File(ourFolder, "models/default.json")
            if (!defaultModel.exists()) {
                defaultModel.writeText(DEFAULT_MODEL, Charsets.UTF_8)
            }
            val defaultTexture = File(ourFolder, "textures/default.png")
            if (!defaultTexture.exists()) {
                defaultTexture.writeBytes(DEFAULT_TEXTURE)
            }
        }

        return gson.fromJson(configFile.reader(), Configuration::class.java)
    }
}